'use strict'
const express = require('express');
const { AppError } = require('../bin/config');
const db = require('../bin/config');
// var conn = require('./../database')

const router = express.Router();
var md5 = require('md5');



router.get('/attendance',(req, res, next) => {
 
    var username = req.body.username;
    var password = req.body.password;
    var id;

    
    var hashpassword=md5(password);

    var sql ='SELECT * FROM employees WHERE username = ? and hashpassword=?';

    global.db.query(sql,[username,hashpassword], (err, result, fields) => {

        if (!result.length) {

          console.log("Incorrect Username or Password");
          res.send("Incorrect Username or Password");
          
        }

        else {
          id = result[0].emp_id;

          var sql2 = "INSERT INTO attendance (emp_id,date,time) VALUES (?,SYSDATE(),SYSDATE())";

          global.db.query(sql2, [id], (err, result) => {

            if (err)
              throw err;
            console.log("1 record inserted");
            res.send("1 record inserted");



          });

        }

      }); 
            
      
 });

module.exports = router;